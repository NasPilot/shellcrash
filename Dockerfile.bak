# åŸºç¡€é•œåƒ
FROM alpine:latest

# ä½œè€…ä¿¡æ¯
LABEL maintainer="ğ‘¬ğ“·ğ’…ğ’† â„µ" \
      version="1.9.2"

# å·¥ä½œç›®å½•
WORKDIR /root

# è®¾ç½®æ—¶åŒº
ENV TZ=Asia/Shanghai

# å¤åˆ¶æ–‡ä»¶
COPY shellcrash.sh /root/shellcrash.sh
# è®¾ç½®è„šæœ¬çš„å¯æ‰§è¡Œæƒé™å¹¶å®‰è£…å¿…è¦è½¯ä»¶
RUN set -ex \
    && chmod +x /root/shellcrash.sh \
    && apk add --no-cache curl wget nftables tzdata \
    && cp /usr/share/zoneinfo/${TZ} /etc/localtime \
    && echo ${TZ} > /etc/timezone && apk del tzdata \
    # å®‰è£…ShellCrash
    && wget https://raw.githubusercontent.com/juewuy/ShellCrash/master/install.sh \
    && (echo "1"; sleep 1; echo "1"; sleep 3; echo "1"; sleep 1; echo "1"; sleep 5) | sh install.sh \
    # é…ç½®ShellCrash
    && source /etc/profile &> /dev/null \
    # && (echo "2"; sleep 2; echo "0"; sleep 2; echo "1"; sleep 2; echo "1"; sleep 2; echo "2"; sleep 2; echo "1"; sleep 2; \
    # && echo "https://suo.yt/4oz7ctI"; sleep 2; echo "1"; sleep 5; echo "1"; sleep 5; echo "0") | /etc/ShellCrash/menu.sh \
    && (echo "2"; sleep 2; \
        echo "1"; sleep 4; \
        echo "1"; sleep 2; \
        echo "2"; sleep 2; \
        echo "1"; sleep 2; \
        echo "https://github.com/NasPilot/shellcrash/raw/main/config.yaml"; sleep 4; \
        echo "1"; sleep 4; \
        #echo "1"; sleep 2; \
        #echo "0"; sleep 2; \
        #echo "1"; sleep 2; \
        echo "0") | /etc/ShellCrash/menu.sh \
    && mv /etc/ShellCrash /etc/ShellCrash_bak && mkdir /etc/ShellCrash \
    && rm -rf /tmp/* /var/cache/apk/*

# ç«¯å£æ˜ å°„
EXPOSE 7890 9999

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV ENV="/etc/profile"

# å¯åŠ¨å‘½ä»¤
ENTRYPOINT ["sh","shellcrash.sh"]